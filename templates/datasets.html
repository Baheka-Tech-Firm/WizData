{% extends "layout.html" %}

{% block title %}WizData - Available Datasets{% endblock %}

{% block content %}
<div x-data="datasetsController()" class="min-h-screen bg-gray-900">
    <!-- Header Section -->
    <div class="relative overflow-hidden bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 py-16">
        <div class="absolute inset-0 bg-black/30"></div>
        <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-4xl md:text-6xl font-bold text-white mb-6">
                    Available Datasets
                </h1>
                <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                    Explore our comprehensive collection of financial, ESG, and market datasets from global sources
                </p>
            </div>
        </div>
    </div>

    <!-- Filter and Search Section -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-gray-800 rounded-xl p-6 border border-gray-700 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Search -->
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-300 mb-2">Search Datasets</label>
                    <div class="relative">
                        <input type="text" x-model="searchQuery" @input="filterDatasets()"
                               placeholder="Search by name, category, or source..."
                               class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                            <i data-lucide="search" class="w-5 h-5 text-gray-400"></i>
                        </div>
                    </div>
                </div>

                <!-- Category Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Category</label>
                    <select x-model="selectedCategory" @change="filterDatasets()"
                            class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">All Categories</option>
                        <option value="financial">Financial Data</option>
                        <option value="esg">ESG Data</option>
                        <option value="market">Market Data</option>
                        <option value="economic">Economic Data</option>
                        <option value="alternative">Alternative Data</option>
                    </select>
                </div>

                <!-- Source Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Source</label>
                    <select x-model="selectedSource" @change="filterDatasets()"
                            class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">All Sources</option>
                        <option value="jse">JSE</option>
                        <option value="bloomberg">Bloomberg</option>
                        <option value="refinitiv">Refinitiv</option>
                        <option value="alpha-vantage">Alpha Vantage</option>
                        <option value="polygon">Polygon</option>
                        <option value="internal">WizData</option>
                    </select>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="mt-6 pt-6 border-t border-gray-700">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-400" x-text="stats.total"></div>
                        <div class="text-sm text-gray-400">Total Datasets</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-400" x-text="stats.active"></div>
                        <div class="text-sm text-gray-400">Active</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-purple-400" x-text="stats.premium"></div>
                        <div class="text-sm text-gray-400">Premium</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-yellow-400" x-text="stats.realtime"></div>
                        <div class="text-sm text-gray-400">Real-time</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Datasets Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <template x-for="dataset in filteredDatasets" :key="dataset.id">
                <div class="bg-gray-800 rounded-xl border border-gray-700 hover:border-blue-500 transition-all duration-300 transform hover:scale-105">
                    <div class="p-6">
                        <!-- Dataset Header -->
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <h3 class="text-xl font-semibold text-white mb-2" x-text="dataset.name"></h3>
                                <div class="flex items-center space-x-2 mb-3">
                                    <span class="px-2 py-1 bg-blue-600 text-white text-xs rounded-full" x-text="dataset.category"></span>
                                    <span class="px-2 py-1 bg-gray-600 text-white text-xs rounded-full" x-text="dataset.source"></span>
                                    <span x-show="dataset.realtime" class="px-2 py-1 bg-green-600 text-white text-xs rounded-full">Real-time</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="w-3 h-3 rounded-full" :class="dataset.status === 'active' ? 'bg-green-400' : 'bg-yellow-400'"></div>
                            </div>
                        </div>

                        <!-- Dataset Description -->
                        <p class="text-gray-300 text-sm mb-4" x-text="dataset.description"></p>

                        <!-- Dataset Metrics -->
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <div class="text-sm text-gray-400">Records</div>
                                <div class="text-lg font-semibold text-white" x-text="dataset.records"></div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-400">Update Freq.</div>
                                <div class="text-lg font-semibold text-white" x-text="dataset.frequency"></div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-400">Coverage</div>
                                <div class="text-lg font-semibold text-white" x-text="dataset.coverage"></div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-400">Format</div>
                                <div class="text-lg font-semibold text-white" x-text="dataset.format"></div>
                            </div>
                        </div>

                        <!-- Access Level -->
                        <div class="mb-4">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-400">Access Level</span>
                                <span class="px-2 py-1 text-xs rounded-full" 
                                      :class="dataset.access === 'free' ? 'bg-green-600 text-white' : 
                                              dataset.access === 'premium' ? 'bg-purple-600 text-white' : 
                                              'bg-yellow-600 text-white'" 
                                      x-text="dataset.access.charAt(0).toUpperCase() + dataset.access.slice(1)"></span>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex space-x-2">
                            <button @click="previewDataset(dataset)" 
                                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                Preview
                            </button>
                            <button @click="accessDataset(dataset)" 
                                    class="flex-1 bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                Access
                            </button>
                        </div>
                    </div>
                </div>
            </template>
        </div>

        <!-- Load More Button -->
        <div class="text-center mt-12" x-show="hasMore">
            <button @click="loadMore()" 
                    class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-medium transition-colors">
                Load More Datasets
            </button>
        </div>
    </div>
</div>

<script>
function datasetsController() {
    return {
        searchQuery: '',
        selectedCategory: '',
        selectedSource: '',
        hasMore: true,
        
        stats: {
            total: 47,
            active: 43,
            premium: 28,
            realtime: 15
        },

        datasets: [
            {
                id: 1,
                name: "JSE Real-time Stock Prices",
                category: "financial",
                source: "jse",
                description: "Live stock prices, volumes, and market data from the Johannesburg Stock Exchange",
                records: "2.3M",
                frequency: "Real-time",
                coverage: "2020-Present",
                format: "JSON/CSV",
                status: "active",
                access: "premium",
                realtime: true,
                sampleData: {
                    symbol: "AGL",
                    price: 234.50,
                    volume: 45623,
                    change: 2.1,
                    timestamp: "2024-01-30T09:15:00Z"
                }
            },
            {
                id: 2,
                name: "African ESG Scores",
                category: "esg",
                source: "internal",
                description: "Comprehensive ESG scoring for African companies based on multiple data sources",
                records: "125K",
                frequency: "Monthly",
                coverage: "2018-Present",
                format: "JSON",
                status: "active",
                access: "premium",
                realtime: false,
                sampleData: {
                    company: "MTN Group",
                    esg_score: 7.2,
                    environmental: 6.8,
                    social: 7.5,
                    governance: 7.3
                }
            },
            {
                id: 3,
                name: "Global Economic Indicators",
                category: "economic",
                source: "alpha-vantage",
                description: "Key economic indicators from major economies worldwide",
                records: "890K",
                frequency: "Daily",
                coverage: "2010-Present",
                format: "JSON/XML",
                status: "active",
                access: "free",
                realtime: false,
                sampleData: {
                    country: "South Africa",
                    gdp_growth: 1.2,
                    inflation: 5.1,
                    unemployment: 29.8,
                    date: "2024-01-30"
                }
            },
            {
                id: 4,
                name: "Cryptocurrency Market Data",
                category: "market",
                source: "polygon",
                description: "Real-time and historical cryptocurrency prices and market metrics",
                records: "15.7M",
                frequency: "Real-time",
                coverage: "2017-Present",
                format: "JSON",
                status: "active",
                access: "premium",
                realtime: true,
                sampleData: {
                    symbol: "BTC-USD",
                    price: 43250.00,
                    volume_24h: 28500000000,
                    market_cap: 847000000000
                }
            },
            {
                id: 5,
                name: "Alternative Data Sentiment",
                category: "alternative",
                source: "internal",
                description: "Social media sentiment analysis for financial instruments",
                records: "5.2M",
                frequency: "Hourly",
                coverage: "2022-Present",
                format: "JSON",
                status: "active",
                access: "enterprise",
                realtime: false,
                sampleData: {
                    symbol: "AAPL",
                    sentiment_score: 0.72,
                    mentions: 1543,
                    positive_ratio: 0.68
                }
            },
            {
                id: 6,
                name: "Dividend Calendar",
                category: "financial",
                source: "refinitiv",
                description: "Upcoming dividend announcements and payment dates",
                records: "67K",
                frequency: "Daily",
                coverage: "Current+6mo",
                format: "JSON/CSV",
                status: "active",
                access: "free",
                realtime: false,
                sampleData: {
                    symbol: "VOD",
                    ex_date: "2024-02-15",
                    amount: 0.85,
                    currency: "GBP"
                }
            }
        ],

        filteredDatasets: [],

        init() {
            this.filteredDatasets = this.datasets;
            this.updateStats();
        },

        filterDatasets() {
            this.filteredDatasets = this.datasets.filter(dataset => {
                const matchesSearch = this.searchQuery === '' || 
                    dataset.name.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                    dataset.description.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                    dataset.source.toLowerCase().includes(this.searchQuery.toLowerCase());

                const matchesCategory = this.selectedCategory === '' || dataset.category === this.selectedCategory;
                const matchesSource = this.selectedSource === '' || dataset.source === this.selectedSource;

                return matchesSearch && matchesCategory && matchesSource;
            });
        },

        updateStats() {
            this.stats.total = this.datasets.length;
            this.stats.active = this.datasets.filter(d => d.status === 'active').length;
            this.stats.premium = this.datasets.filter(d => d.access === 'premium' || d.access === 'enterprise').length;
            this.stats.realtime = this.datasets.filter(d => d.realtime).length;
        },

        previewDataset(dataset) {
            // Redirect directly to dataset details or licensing
            this.accessDataset(dataset);
        },

        accessDataset(dataset) {
            // In a real implementation, this would redirect to licensing or dataset details
            alert(`Requesting access to ${dataset.name}. You will be redirected to licensing.`);
            // Could redirect to: window.location.href = '/licensing?dataset=' + dataset.id;
        },

        loadMore() {
            // Simulate loading more datasets
            this.hasMore = false;
        }
    }
}
</script>
{% endblock %}
