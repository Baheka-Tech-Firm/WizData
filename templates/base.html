<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}WizData Platform{% endblock %}</title>
    
    <!-- Production Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.0/dist/tailwind.min.css" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Chart.js with Date Adapter -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <style>
        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        
        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Custom colors */
        .bg-sidebar { background-color: #111827; }
        .bg-topbar { background-color: #1E293B; }
        .bg-hover-gray { background-color: #1F2937; }
    </style>
    
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-900 text-white font-sans">
    <!-- Top Bar -->
    <header class="fixed top-0 left-0 right-0 z-40 h-16 bg-topbar border-b border-gray-700 flex items-center px-8">
        <div class="flex items-center space-x-6 flex-1">
            <!-- App Name -->
            <div class="font-bold text-xl text-white">WizData</div>
            
            <!-- App Switcher -->
            <div class="relative">
                <button id="appSwitcher" class="flex items-center space-x-2 px-3 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors">
                    <i data-lucide="grid-3x3" class="w-4 h-4"></i>
                    <span class="text-sm">{% block page_title %}Dashboard{% endblock %}</span>
                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                </button>
                
                <!-- Dropdown Menu -->
                <div id="appDropdown" class="hidden absolute top-full mt-2 left-0 bg-gray-800 rounded-lg shadow-xl border border-gray-700 min-w-[200px] z-50">
                    <div class="p-2">
                        <div class="text-xs text-gray-400 px-3 py-2 uppercase tracking-wider">Products</div>
                        <a href="#" class="flex items-center space-x-3 px-3 py-2 rounded hover:bg-gray-700 transition-colors">
                            <i data-lucide="bar-chart-3" class="w-4 h-4 text-blue-400"></i>
                            <span>VueOn Charts</span>
                        </a>
                        <a href="#" class="flex items-center space-x-3 px-3 py-2 rounded hover:bg-gray-700 transition-colors">
                            <i data-lucide="trending-up" class="w-4 h-4 text-green-400"></i>
                            <span>Trader (Strada)</span>
                        </a>
                        <a href="#" class="flex items-center space-x-3 px-3 py-2 rounded hover:bg-gray-700 transition-colors">
                            <i data-lucide="activity" class="w-4 h-4 text-purple-400"></i>
                            <span>Pulse</span>
                        </a>
                        <a href="#" class="flex items-center space-x-3 px-3 py-2 rounded hover:bg-gray-700 transition-colors">
                            <i data-lucide="shield" class="w-4 h-4 text-yellow-400"></i>
                            <span>Wealth (Novia)</span>
                        </a>
                        <a href="#" class="flex items-center space-x-3 px-3 py-2 rounded hover:bg-gray-700 transition-colors">
                            <i data-lucide="users" class="w-4 h-4 text-indigo-400"></i>
                            <span>Connect</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Center Search -->
        <div class="flex-1 max-w-md mx-8">
            <div class="relative">
                <input type="text" placeholder="Search..." class="w-full bg-gray-700 text-white px-4 py-2 pl-10 pr-12 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-xs text-gray-400 bg-gray-600 px-2 py-1 rounded">âŒ˜K</div>
            </div>
        </div>
        
        <!-- Right Side -->
        <div class="flex items-center space-x-4">
            <!-- System Status -->
            <div class="flex items-center space-x-2">
                <div class="w-2 h-2 bg-green-500 rounded-full pulse-dot"></div>
                <span class="text-sm text-gray-300">System OK</span>
            </div>
            
            <!-- AI Insights Button -->
            <button id="aiInsightsBtn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm font-medium transition-colors">
                <i data-lucide="brain" class="w-4 h-4 inline mr-2"></i>
                AI Insights
            </button>
            
            <!-- User Menu -->
            <div class="relative">
                <button id="userMenu" class="flex items-center space-x-2 hover:bg-gray-700 rounded-lg p-2 transition-colors">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center font-medium text-sm">
                        A
                    </div>
                    <span class="text-sm">Admin</span>
                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <nav class="fixed left-0 top-16 bottom-0 w-56 bg-sidebar border-r border-gray-700 z-30 overflow-y-auto">
        <div class="p-4">
            <!-- Navigation Items -->
            <div class="space-y-2">
                <a href="/" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg {% if request.endpoint == 'index' %}bg-blue-600 text-white{% else %}hover:bg-hover-gray transition-colors text-gray-300 hover:text-white{% endif %}">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                    <span>Dashboard</span>
                </a>
                <a href="/scrapers" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg {% if request.endpoint == 'scrapers' %}bg-blue-600 text-white{% else %}hover:bg-hover-gray transition-colors text-gray-300 hover:text-white{% endif %}">
                    <i data-lucide="database" class="w-5 h-5"></i>
                    <span>Sources</span>
                </a>
                <a href="/jobs" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg {% if request.endpoint == 'jobs' %}bg-blue-600 text-white{% else %}hover:bg-hover-gray transition-colors text-gray-300 hover:text-white{% endif %}">
                    <i data-lucide="clock" class="w-5 h-5"></i>
                    <span>Jobs</span>
                </a>
                <a href="/charting" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg {% if 'charting' in request.endpoint %}bg-blue-600 text-white{% else %}hover:bg-hover-gray transition-colors text-gray-300 hover:text-white{% endif %}">
                    <i data-lucide="search" class="w-5 h-5"></i>
                    <span>Screener</span>
                </a>
                <a href="/charting" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-hover-gray transition-colors text-gray-300 hover:text-white">
                    <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                    <span>Charts</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-hover-gray transition-colors text-gray-300 hover:text-white">
                    <i data-lucide="calendar" class="w-5 h-5"></i>
                    <span>Events</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-hover-gray transition-colors text-gray-300 hover:text-white">
                    <i data-lucide="bell" class="w-5 h-5"></i>
                    <span>Alerts</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-hover-gray transition-colors text-gray-300 hover:text-white">
                    <i data-lucide="file-text" class="w-5 h-5"></i>
                    <span>Logs</span>
                </a>
            </div>
            
            <!-- API Keys Section -->
            <div class="mt-8 pt-4 border-t border-gray-700">
                <div class="text-xs text-gray-400 px-3 py-2 uppercase tracking-wider">Administration</div>
                <a href="/admin/api-keys" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg {% if 'api-keys' in request.endpoint %}bg-blue-600 text-white{% else %}hover:bg-hover-gray transition-colors text-gray-300 hover:text-white{% endif %}">
                    <i data-lucide="key" class="w-5 h-5"></i>
                    <span>API Keys</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-hover-gray transition-colors text-gray-300 hover:text-white">
                    <i data-lucide="settings" class="w-5 h-5"></i>
                    <span>Settings</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="ml-56 mt-16 p-8">
        <div class="max-w-7xl mx-auto">
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- AI Insights Panel -->
    <div id="aiInsightsPanel" class="fixed right-0 top-16 bottom-0 w-80 bg-gray-800 border-l border-gray-700 transform translate-x-full transition-transform duration-300 z-40 overflow-y-auto">
        <div class="p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-white">AI Insights</h3>
                <button id="closeAiPanel" class="text-gray-400 hover:text-white">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <div class="space-y-4" id="aiInsightsList">
                <!-- Dynamic AI insights will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Global navigation functionality
        document.addEventListener('DOMContentLoaded', function() {
            // App switcher dropdown
            const appSwitcher = document.getElementById('appSwitcher');
            const appDropdown = document.getElementById('appDropdown');
            
            if (appSwitcher && appDropdown) {
                appSwitcher.addEventListener('click', () => {
                    appDropdown.classList.toggle('hidden');
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#appSwitcher')) {
                        appDropdown.classList.add('hidden');
                    }
                });
            }

            // AI Insights panel
            const aiInsightsBtn = document.getElementById('aiInsightsBtn');
            const aiInsightsPanel = document.getElementById('aiInsightsPanel');
            const closeAiPanel = document.getElementById('closeAiPanel');
            
            if (aiInsightsBtn && aiInsightsPanel) {
                aiInsightsBtn.addEventListener('click', () => {
                    aiInsightsPanel.classList.toggle('translate-x-full');
                });
            }
            
            if (closeAiPanel && aiInsightsPanel) {
                closeAiPanel.addEventListener('click', () => {
                    aiInsightsPanel.classList.add('translate-x-full');
                });
            }

            // Search functionality
            document.addEventListener('keydown', (e) => {
                if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                    e.preventDefault();
                    const searchInput = document.querySelector('input[placeholder="Search..."]');
                    if (searchInput) {
                        searchInput.focus();
                    }
                }
            });

            // Load AI insights
            loadAIInsights();
        });

        function loadAIInsights() {
            const insights = [
                {
                    symbol: 'SOL',
                    message: '300% spike in volume detected',
                    tags: ['#volume', '#alert'],
                    severity: 'high',
                    time: '2 mins ago'
                },
                {
                    symbol: 'ETH',
                    message: 'Sentiment shifted to neutral',
                    tags: ['#sentiment'],
                    severity: 'medium',
                    time: '5 mins ago'
                },
                {
                    symbol: 'JSE:NPN',
                    message: 'Technical breakout pattern forming',
                    tags: ['#technical', '#pattern'],
                    severity: 'medium',
                    time: '12 mins ago'
                }
            ];

            const container = document.getElementById('aiInsightsList');
            if (container) {
                container.innerHTML = insights.map(insight => `
                    <div class="p-4 bg-gray-700 rounded-lg border-l-4 ${
                        insight.severity === 'high' ? 'border-red-500' : 
                        insight.severity === 'medium' ? 'border-yellow-500' : 'border-blue-500'
                    }">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-medium text-white">${insight.symbol}</span>
                            <span class="text-xs text-gray-400">${insight.time}</span>
                        </div>
                        <p class="text-sm text-gray-300 mb-2">${insight.message}</p>
                        <div class="flex flex-wrap gap-1">
                            ${insight.tags.map(tag => `
                                <span class="text-xs px-2 py-1 bg-blue-600 text-blue-100 rounded">${tag}</span>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }
        }
    </script>

    {% block extra_scripts %}{% endblock %}
</body>
</html>