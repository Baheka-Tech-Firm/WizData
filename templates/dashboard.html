<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WizData Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        
        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'sidebar-bg': '#111827',
                        'topbar-bg': '#1E293B',
                        'hover-gray': '#1F2937'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-900 text-white font-sans">
    <!-- Top Bar -->
    <header class="fixed top-0 left-0 right-0 z-40 h-16 bg-topbar-bg border-b border-gray-700 flex items-center px-8">
        <div class="flex items-center space-x-6 flex-1">
            <!-- App Name -->
            <div class="font-bold text-xl text-white">WizData</div>
            
            <!-- App Switcher -->
            <div class="relative">
                <button id="appSwitcher" class="flex items-center space-x-2 px-3 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors">
                    <i data-lucide="grid-3x3" class="w-4 h-4"></i>
                    <span class="text-sm">Dashboard</span>
                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                </button>
                
                <!-- Dropdown Menu -->
                <div id="appDropdown" class="hidden absolute top-full mt-2 left-0 bg-gray-800 rounded-lg shadow-xl border border-gray-700 min-w-[200px] z-50">
                    <div class="p-2">
                        <div class="text-xs text-gray-400 px-3 py-2 uppercase tracking-wider">Products</div>
                        <a href="#" class="flex items-center space-x-3 px-3 py-2 rounded hover:bg-gray-700 transition-colors">
                            <i data-lucide="bar-chart-3" class="w-4 h-4 text-blue-400"></i>
                            <span>VueOn Charts</span>
                        </a>
                        <a href="#" class="flex items-center space-x-3 px-3 py-2 rounded hover:bg-gray-700 transition-colors">
                            <i data-lucide="trending-up" class="w-4 h-4 text-green-400"></i>
                            <span>Trader (Strada)</span>
                        </a>
                        <a href="#" class="flex items-center space-x-3 px-3 py-2 rounded hover:bg-gray-700 transition-colors">
                            <i data-lucide="pulse" class="w-4 h-4 text-purple-400"></i>
                            <span>Pulse</span>
                        </a>
                        <a href="#" class="flex items-center space-x-3 px-3 py-2 rounded hover:bg-gray-700 transition-colors">
                            <i data-lucide="shield" class="w-4 h-4 text-yellow-400"></i>
                            <span>Wealth (Novia)</span>
                        </a>
                        <a href="#" class="flex items-center space-x-3 px-3 py-2 rounded hover:bg-gray-700 transition-colors">
                            <i data-lucide="users" class="w-4 h-4 text-indigo-400"></i>
                            <span>Connect</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Center Search -->
        <div class="flex-1 max-w-md mx-8">
            <div class="relative">
                <input type="text" placeholder="Search..." class="w-full bg-gray-700 text-white px-4 py-2 pl-10 pr-12 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-xs text-gray-400 bg-gray-600 px-2 py-1 rounded">âŒ˜K</div>
            </div>
        </div>
        
        <!-- Right Side -->
        <div class="flex items-center space-x-4">
            <!-- System Status -->
            <div class="flex items-center space-x-2">
                <div class="w-2 h-2 bg-green-500 rounded-full pulse-dot"></div>
                <span class="text-sm text-gray-300">System OK</span>
            </div>
            
            <!-- AI Insights Button -->
            <button id="aiInsightsBtn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm font-medium transition-colors">
                <i data-lucide="brain" class="w-4 h-4 inline mr-2"></i>
                AI Insights
            </button>
            
            <!-- User Menu -->
            <div class="relative">
                <button id="userMenu" class="flex items-center space-x-2 hover:bg-gray-700 rounded-lg p-2 transition-colors">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center font-medium text-sm">
                        A
                    </div>
                    <span class="text-sm">Admin</span>
                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <nav class="fixed left-0 top-16 bottom-0 w-56 bg-sidebar-bg border-r border-gray-700 z-30 overflow-y-auto">
        <div class="p-4">
            <!-- Navigation Items -->
            <div class="space-y-2">
                <a href="#" class="nav-item active flex items-center space-x-3 px-3 py-2 rounded-lg bg-blue-600 text-white">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                    <span>Dashboard</span>
                </a>
                <a href="/scrapers" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-hover-gray transition-colors text-gray-300 hover:text-white">
                    <i data-lucide="database" class="w-5 h-5"></i>
                    <span>Sources</span>
                </a>
                <a href="/jobs" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-hover-gray transition-colors text-gray-300 hover:text-white">
                    <i data-lucide="clock" class="w-5 h-5"></i>
                    <span>Jobs</span>
                </a>
                <a href="/charting" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-hover-gray transition-colors text-gray-300 hover:text-white">
                    <i data-lucide="search" class="w-5 h-5"></i>
                    <span>Screener</span>
                </a>
                <a href="/charting" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-hover-gray transition-colors text-gray-300 hover:text-white">
                    <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                    <span>Charts</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-hover-gray transition-colors text-gray-300 hover:text-white">
                    <i data-lucide="calendar" class="w-5 h-5"></i>
                    <span>Events</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-hover-gray transition-colors text-gray-300 hover:text-white">
                    <i data-lucide="bell" class="w-5 h-5"></i>
                    <span>Alerts</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-hover-gray transition-colors text-gray-300 hover:text-white">
                    <i data-lucide="file-text" class="w-5 h-5"></i>
                    <span>Logs</span>
                </a>
            </div>
            
            <!-- API Keys Section -->
            <div class="mt-8 pt-4 border-t border-gray-700">
                <div class="text-xs text-gray-400 px-3 py-2 uppercase tracking-wider">Administration</div>
                <a href="/admin/api-keys" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-hover-gray transition-colors text-gray-300 hover:text-white">
                    <i data-lucide="key" class="w-5 h-5"></i>
                    <span>API Keys</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-hover-gray transition-colors text-gray-300 hover:text-white">
                    <i data-lucide="settings" class="w-5 h-5"></i>
                    <span>Settings</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="ml-56 mt-16 p-8">
        <div class="max-w-7xl mx-auto">
            <!-- Page Header -->
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-white mb-2">Dashboard</h1>
                <p class="text-gray-400">Monitor your financial data platform performance and insights</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Total Sources -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-gray-600 transition-colors fade-in">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm font-medium">Total Sources</p>
                            <p class="text-2xl font-bold text-white mt-1" id="totalSources">-</p>
                        </div>
                        <div class="p-3 bg-blue-600 rounded-lg">
                            <i data-lucide="database" class="w-6 h-6 text-white"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <span class="text-green-500 text-sm font-medium" id="sourcesChange">+0%</span>
                        <span class="text-gray-400 text-sm ml-1">vs last month</span>
                    </div>
                </div>

                <!-- Tracked Symbols -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-gray-600 transition-colors fade-in">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm font-medium">Tracked Symbols</p>
                            <p class="text-2xl font-bold text-white mt-1" id="trackedSymbols">-</p>
                        </div>
                        <div class="p-3 bg-green-600 rounded-lg">
                            <i data-lucide="trending-up" class="w-6 h-6 text-white"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <span class="text-green-500 text-sm font-medium" id="symbolsChange">+0%</span>
                        <span class="text-gray-400 text-sm ml-1">vs last month</span>
                    </div>
                </div>

                <!-- Data Points -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-gray-600 transition-colors fade-in">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm font-medium">Data Points</p>
                            <p class="text-2xl font-bold text-white mt-1" id="dataPoints">-</p>
                        </div>
                        <div class="p-3 bg-purple-600 rounded-lg">
                            <i data-lucide="activity" class="w-6 h-6 text-white"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <span class="text-green-500 text-sm font-medium" id="dataPointsChange">+0%</span>
                        <span class="text-gray-400 text-sm ml-1">vs last month</span>
                    </div>
                </div>

                <!-- API Requests -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-gray-600 transition-colors fade-in">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm font-medium">API Requests</p>
                            <p class="text-2xl font-bold text-white mt-1" id="apiRequests">-</p>
                        </div>
                        <div class="p-3 bg-yellow-600 rounded-lg">
                            <i data-lucide="zap" class="w-6 h-6 text-white"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <span class="text-green-500 text-sm font-medium" id="requestsChange">+0%</span>
                        <span class="text-gray-400 text-sm ml-1">vs last hour</span>
                    </div>
                </div>
            </div>

            <!-- Chart and Top Performers Row -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                <!-- Market Overview Chart -->
                <div class="lg:col-span-2 bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-white">Market Overview</h3>
                        <div class="flex items-center space-x-2">
                            <button class="time-range-btn px-3 py-1 text-sm rounded bg-blue-600 text-white" data-range="1D">1D</button>
                            <button class="time-range-btn px-3 py-1 text-sm rounded text-gray-400 hover:text-white hover:bg-gray-700" data-range="1W">1W</button>
                            <button class="time-range-btn px-3 py-1 text-sm rounded text-gray-400 hover:text-white hover:bg-gray-700" data-range="1M">1M</button>
                            <button class="time-range-btn px-3 py-1 text-sm rounded text-gray-400 hover:text-white hover:bg-gray-700" data-range="1Y">1Y</button>
                        </div>
                    </div>
                    <div class="h-80">
                        <canvas id="marketChart"></canvas>
                    </div>
                </div>

                <!-- Top Performing Symbols -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold text-white mb-6">Top Performers</h3>
                    <div class="space-y-4" id="topPerformers">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Market Insights Table -->
            <div class="bg-gray-800 rounded-lg border border-gray-700">
                <div class="p-6 border-b border-gray-700">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-white">Market Insights</h3>
                        <div class="flex items-center space-x-2">
                            <button class="filter-btn px-3 py-1 text-sm rounded bg-blue-600 text-white" data-filter="all">All</button>
                            <button class="filter-btn px-3 py-1 text-sm rounded text-gray-400 hover:text-white hover:bg-gray-700" data-filter="jse">JSE</button>
                            <button class="filter-btn px-3 py-1 text-sm rounded text-gray-400 hover:text-white hover:bg-gray-700" data-filter="crypto">Crypto</button>
                            <button class="filter-btn px-3 py-1 text-sm rounded text-gray-400 hover:text-white hover:bg-gray-700" data-filter="forex">Forex</button>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-700">
                                <th class="text-left p-4 text-gray-400 font-medium">Symbol</th>
                                <th class="text-left p-4 text-gray-400 font-medium">Name</th>
                                <th class="text-left p-4 text-gray-400 font-medium">Sector</th>
                                <th class="text-right p-4 text-gray-400 font-medium">Price</th>
                                <th class="text-right p-4 text-gray-400 font-medium">Change</th>
                                <th class="text-right p-4 text-gray-400 font-medium">Volume</th>
                                <th class="text-right p-4 text-gray-400 font-medium">Updated</th>
                            </tr>
                        </thead>
                        <tbody id="marketInsightsTable">
                            <!-- Dynamic content will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- AI Insights Panel -->
    <div id="aiInsightsPanel" class="fixed right-0 top-16 bottom-0 w-80 bg-gray-800 border-l border-gray-700 transform translate-x-full transition-transform duration-300 z-40 overflow-y-auto">
        <div class="p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-white">AI Insights</h3>
                <button id="closeAiPanel" class="text-gray-400 hover:text-white">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <div class="space-y-4" id="aiInsightsList">
                <!-- Dynamic AI insights will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Dashboard data management
        class WizDataDashboard {
            constructor() {
                this.marketChart = null;
                this.init();
            }

            async init() {
                await this.loadDashboardData();
                this.initChart();
                this.setupEventListeners();
                this.loadTopPerformers();
                this.loadMarketInsights();
                this.loadAIInsights();
                
                // Auto-refresh every 30 seconds
                setInterval(() => this.refreshData(), 30000);
            }

            async loadDashboardData() {
                try {
                    // Load symbols count
                    const symbolsResponse = await fetch('/api/v1/charting/symbols');
                    if (symbolsResponse.ok) {
                        const symbolsData = await symbolsResponse.json();
                        document.getElementById('trackedSymbols').textContent = symbolsData.count || 0;
                    }

                    // Load scrapers data
                    const scrapersResponse = await fetch('/api/scrapers/sources');
                    if (scrapersResponse.ok) {
                        const scrapersData = await scrapersResponse.json();
                        document.getElementById('totalSources').textContent = scrapersData.sources ? scrapersData.sources.length : 0;
                    }

                    // Simulate other metrics
                    document.getElementById('dataPoints').textContent = '1.2M';
                    document.getElementById('apiRequests').textContent = '45.2K';
                    
                    // Add random change percentages
                    document.getElementById('sourcesChange').textContent = '+12%';
                    document.getElementById('symbolsChange').textContent = '+8%';
                    document.getElementById('dataPointsChange').textContent = '+24%';
                    document.getElementById('requestsChange').textContent = '+156%';

                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                }
            }

            initChart() {
                const ctx = document.getElementById('marketChart');
                if (!ctx) return;

                // Generate sample data
                const generateData = (days = 30) => {
                    const data = [];
                    const now = new Date();
                    for (let i = days; i >= 0; i--) {
                        const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
                        data.push({
                            x: date,
                            jse: 65000 + Math.random() * 5000,
                            btc: 45000 + Math.random() * 10000,
                            eur: 1.08 + Math.random() * 0.1
                        });
                    }
                    return data;
                };

                const data = generateData();

                this.marketChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'JSE Top 40',
                            data: data.map(d => ({ x: d.x, y: d.jse })),
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: false
                        }, {
                            label: 'BTC/USD',
                            data: data.map(d => ({ x: d.x, y: d.btc })),
                            borderColor: '#F59E0B',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4,
                            fill: false,
                            yAxisID: 'y1'
                        }, {
                            label: 'EUR/USD',
                            data: data.map(d => ({ x: d.x, y: d.eur })),
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            fill: false,
                            yAxisID: 'y2'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#9CA3AF'
                                }
                            }
                        },
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    unit: 'day'
                                },
                                grid: {
                                    color: '#374151'
                                },
                                ticks: {
                                    color: '#9CA3AF'
                                }
                            },
                            y: {
                                position: 'left',
                                grid: {
                                    color: '#374151'
                                },
                                ticks: {
                                    color: '#9CA3AF'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: false,
                                position: 'right'
                            },
                            y2: {
                                type: 'linear',
                                display: false,
                                position: 'right'
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        }
                    }
                });
            }

            async loadTopPerformers() {
                try {
                    const response = await fetch('/api/v1/charting/screener?sort_by=change_percent&order=desc&limit=5');
                    if (!response.ok) throw new Error('Failed to load screener data');
                    
                    const data = await response.json();
                    const container = document.getElementById('topPerformers');
                    
                    if (data.results && data.results.length > 0) {
                        container.innerHTML = data.results.map(symbol => `
                            <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors">
                                <div>
                                    <div class="font-medium text-white">${symbol.symbol}</div>
                                    <div class="text-sm text-gray-400">$${symbol.price || 'N/A'}</div>
                                </div>
                                <div class="text-right">
                                    <div class="font-medium ${(symbol.change_percent || 0) >= 0 ? 'text-green-400' : 'text-red-400'}">
                                        ${(symbol.change_percent || 0) >= 0 ? '+' : ''}${(symbol.change_percent || 0).toFixed(2)}%
                                    </div>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        container.innerHTML = '<div class="text-center text-gray-400 py-8">No data available</div>';
                    }
                } catch (error) {
                    console.error('Error loading top performers:', error);
                    document.getElementById('topPerformers').innerHTML = '<div class="text-center text-red-400 py-8">Error loading data</div>';
                }
            }

            async loadMarketInsights() {
                try {
                    const response = await fetch('/api/v1/charting/symbols');
                    if (!response.ok) throw new Error('Failed to load symbols');
                    
                    const data = await response.json();
                    const tbody = document.getElementById('marketInsightsTable');
                    
                    if (data.symbols) {
                        const allSymbols = [
                            ...(data.symbols.jse || []),
                            ...(data.symbols.crypto || []),
                            ...(data.symbols.forex || []),
                            ...(data.symbols.stocks || [])
                        ];

                        tbody.innerHTML = allSymbols.slice(0, 10).map(symbol => {
                            const change = (Math.random() - 0.5) * 10; // Random change for demo
                            const price = Math.random() * 1000;
                            const volume = Math.floor(Math.random() * 1000000);
                            
                            return `
                                <tr class="border-b border-gray-700 hover:bg-gray-700 transition-colors">
                                    <td class="p-4 font-medium text-white">${symbol.symbol}</td>
                                    <td class="p-4 text-gray-300">${symbol.name}</td>
                                    <td class="p-4 text-gray-400">${symbol.sector || 'N/A'}</td>
                                    <td class="p-4 text-right text-white">$${price.toFixed(2)}</td>
                                    <td class="p-4 text-right ${change >= 0 ? 'text-green-400' : 'text-red-400'}">${change >= 0 ? '+' : ''}${change.toFixed(2)}%</td>
                                    <td class="p-4 text-right text-gray-300">${volume.toLocaleString()}</td>
                                    <td class="p-4 text-right text-gray-400">Just now</td>
                                </tr>
                            `;
                        }).join('');
                    }
                } catch (error) {
                    console.error('Error loading market insights:', error);
                }
            }

            loadAIInsights() {
                const insights = [
                    {
                        symbol: 'SOL',
                        message: '300% spike in volume detected',
                        tags: ['#volume', '#alert'],
                        severity: 'high',
                        time: '2 mins ago'
                    },
                    {
                        symbol: 'ETH',
                        message: 'Sentiment shifted to neutral',
                        tags: ['#sentiment'],
                        severity: 'medium',
                        time: '5 mins ago'
                    },
                    {
                        symbol: 'JSE:NPN',
                        message: 'Technical breakout pattern forming',
                        tags: ['#technical', '#pattern'],
                        severity: 'medium',
                        time: '12 mins ago'
                    },
                    {
                        symbol: 'BTC',
                        message: 'Support level holding strong',
                        tags: ['#support', '#technical'],
                        severity: 'low',
                        time: '18 mins ago'
                    }
                ];

                const container = document.getElementById('aiInsightsList');
                container.innerHTML = insights.map(insight => `
                    <div class="p-4 bg-gray-700 rounded-lg border-l-4 ${
                        insight.severity === 'high' ? 'border-red-500' : 
                        insight.severity === 'medium' ? 'border-yellow-500' : 'border-blue-500'
                    }">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-medium text-white">${insight.symbol}</span>
                            <span class="text-xs text-gray-400">${insight.time}</span>
                        </div>
                        <p class="text-sm text-gray-300 mb-2">${insight.message}</p>
                        <div class="flex flex-wrap gap-1">
                            ${insight.tags.map(tag => `
                                <span class="text-xs px-2 py-1 bg-blue-600 text-blue-100 rounded">${tag}</span>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }

            setupEventListeners() {
                // App switcher dropdown
                document.getElementById('appSwitcher').addEventListener('click', () => {
                    const dropdown = document.getElementById('appDropdown');
                    dropdown.classList.toggle('hidden');
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#appSwitcher')) {
                        document.getElementById('appDropdown').classList.add('hidden');
                    }
                });

                // AI Insights panel
                document.getElementById('aiInsightsBtn').addEventListener('click', () => {
                    const panel = document.getElementById('aiInsightsPanel');
                    panel.classList.toggle('translate-x-full');
                });

                document.getElementById('closeAiPanel').addEventListener('click', () => {
                    document.getElementById('aiInsightsPanel').classList.add('translate-x-full');
                });

                // Time range buttons
                document.querySelectorAll('.time-range-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.time-range-btn').forEach(b => {
                            b.classList.remove('bg-blue-600', 'text-white');
                            b.classList.add('text-gray-400', 'hover:text-white', 'hover:bg-gray-700');
                        });
                        btn.classList.add('bg-blue-600', 'text-white');
                        btn.classList.remove('text-gray-400', 'hover:text-white', 'hover:bg-gray-700');
                    });
                });

                // Filter buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.filter-btn').forEach(b => {
                            b.classList.remove('bg-blue-600', 'text-white');
                            b.classList.add('text-gray-400', 'hover:text-white', 'hover:bg-gray-700');
                        });
                        btn.classList.add('bg-blue-600', 'text-white');
                        btn.classList.remove('text-gray-400', 'hover:text-white', 'hover:bg-gray-700');
                    });
                });

                // Search functionality
                document.addEventListener('keydown', (e) => {
                    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                        e.preventDefault();
                        document.querySelector('input[placeholder="Search..."]').focus();
                    }
                });
            }

            async refreshData() {
                await this.loadDashboardData();
                this.loadTopPerformers();
                this.loadMarketInsights();
            }
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new WizDataDashboard();
        });
    </script>
</body>
</html>