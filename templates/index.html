{% extends "layout.html" %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <div class="row mb-5">
        <div class="col-lg-8 mx-auto text-center">
            <h1 class="display-4 fw-bold mb-4 animate__animated animate__fadeIn">WizData Dashboard</h1>
            <p class="lead text-muted animate__animated animate__fadeIn animate__delay-1s">
                Comprehensive financial data acquisition and API service with advanced ESG and regional data integration capabilities.
            </p>
            <div class="d-flex justify-content-center gap-3 mt-4 animate__animated animate__fadeIn animate__delay-2s">
                <a href="/api-services" class="btn btn-primary rounded-pill">
                    <i class="fas fa-plug me-2"></i>Explore API
                </a>
                <a href="/esg/africa" class="btn btn-info rounded-pill">
                    <i class="fas fa-leaf me-2"></i>Africa ESG Data
                </a>
                <a href="/scrapers" class="btn btn-success rounded-pill">
                    <i class="fas fa-robot me-2"></i>Live Data Collection
                </a>
                <a href="/charting" class="btn btn-warning rounded-pill">
                    <i class="fas fa-chart-candlestick me-2"></i>Pro Charting
                </a>
            </div>
        </div>
    </div>

    <!-- Stats Overview -->
    <div class="row mb-5">
        <div class="col-md-3 mb-4" data-aos="fade-up" data-aos-delay="100">
            <div class="card h-100 bg-primary-subtle stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-database fa-3x mb-3 text-primary"></i>
                    <h3 class="card-title fw-bold counter">12+</h3>
                    <p class="card-text text-muted">Data Sources</p>
                    <div class="progress">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: 95%;" aria-valuenow="95" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-4" data-aos="fade-up" data-aos-delay="200">
            <div class="card h-100 bg-success-subtle stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-globe fa-3x mb-3 text-success"></i>
                    <h3 class="card-title fw-bold counter">5+</h3>
                    <p class="card-text text-muted">Global Markets</p>
                    <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 85%;" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-4" data-aos="fade-up" data-aos-delay="300">
            <div class="card h-100 bg-info-subtle stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-leaf fa-3x mb-3 text-info"></i>
                    <h3 class="card-title fw-bold counter">20+</h3>
                    <p class="card-text text-muted">ESG Metrics</p>
                    <div class="progress">
                        <div class="progress-bar bg-info" role="progressbar" style="width: 75%;" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-4" data-aos="fade-up" data-aos-delay="400">
            <div class="card h-100 bg-warning-subtle stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-broadcast-tower fa-3x mb-3 text-warning"></i>
                    <h3 class="card-title fw-bold counter">99.9%</h3>
                    <p class="card-text text-muted">API Uptime</p>
                    <div class="progress">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: 99%;" aria-valuenow="99" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Quality Overview -->
    <div class="row mb-5">
        <div class="col-lg-6 mb-4" data-aos="fade-right">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-check-circle me-2 text-success"></i>Data Quality Metrics</h5>
                    <a href="/quality" class="btn btn-sm btn-outline-secondary rounded-pill"><i class="fas fa-external-link-alt me-1"></i>Details</a>
                </div>
                <div class="card-body">
                    <canvas id="qualityChart" height="250"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4" data-aos="fade-left">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-chart-line me-2 text-primary"></i>API Usage Trends</h5>
                    <a href="/api-services" class="btn btn-sm btn-outline-secondary rounded-pill"><i class="fas fa-external-link-alt me-1"></i>API Docs</a>
                </div>
                <div class="card-body">
                    <canvas id="apiUsageChart" height="250"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Feature Highlights -->
    <div class="row mb-5" data-aos="fade-up">
        <div class="col-12 mb-4">
            <h2 class="text-center fw-bold mb-4">Platform Features</h2>
        </div>
        
        <div class="col-md-4 mb-4" data-aos="zoom-in" data-aos-delay="100">
            <div class="card h-100">
                <div class="card-body">
                    <div class="text-center mb-3">
                        <i class="fas fa-robot fa-3x text-primary"></i>
                    </div>
                    <h5 class="card-title text-center">AI-Powered Insights</h5>
                    <p class="card-text text-muted">
                        Leverage OpenAI integration for advanced data exploration, pattern recognition, and trend analysis.
                    </p>
                    <a href="/insights" class="btn btn-sm btn-outline-primary w-100 rounded-pill mt-3">Explore Insights</a>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-4" data-aos="zoom-in" data-aos-delay="200">
            <div class="card h-100">
                <div class="card-body">
                    <div class="text-center mb-3">
                        <i class="fas fa-broadcast-tower fa-3x text-success"></i>
                    </div>
                    <h5 class="card-title text-center">Real-time Data Streaming</h5>
                    <p class="card-text text-muted">
                        WebSocket integration for live market data with customizable price alerts and subscription management.
                    </p>
                    <a href="/websocket" class="btn btn-sm btn-outline-success w-100 rounded-pill mt-3">Live Data Demo</a>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-4" data-aos="zoom-in" data-aos-delay="300">
            <div class="card h-100">
                <div class="card-body">
                    <div class="text-center mb-3">
                        <i class="fas fa-leaf fa-3x text-info"></i>
                    </div>
                    <h5 class="card-title text-center">Africa ESG Integration</h5>
                    <p class="card-text text-muted">
                        Specialized environmental, social, and governance data for African regions with comprehensive metrics.
                    </p>
                    <a href="/esg/africa" class="btn btn-sm btn-outline-info w-100 rounded-pill mt-3">View ESG Dashboard</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Latest Activity -->
    <div class="row mb-5" data-aos="fade-up">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-history me-2"></i>Recent Activity</h5>
                    <button class="btn btn-sm btn-outline-secondary rounded-pill refresh-btn">
                        <i class="fas fa-sync-alt me-1"></i>Refresh
                    </button>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover" id="activity-table">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>2025-04-04 07:45:12</td>
                                    <td><span class="badge bg-primary">Data Import</span></td>
                                    <td>JSE market data updated</td>
                                    <td><span class="badge bg-success">Success</span></td>
                                </tr>
                                <tr>
                                    <td>2025-04-04 07:30:02</td>
                                    <td><span class="badge bg-info">ESG</span></td>
                                    <td>South Africa ESG metrics updated</td>
                                    <td><span class="badge bg-success">Success</span></td>
                                </tr>
                                <tr>
                                    <td>2025-04-04 07:15:32</td>
                                    <td><span class="badge bg-success">API</span></td>
                                    <td>Global market API endpoints refreshed</td>
                                    <td><span class="badge bg-success">Success</span></td>
                                </tr>
                                <tr>
                                    <td>2025-04-04 07:00:10</td>
                                    <td><span class="badge bg-warning">Quality</span></td>
                                    <td>Data reconciliation process completed</td>
                                    <td><span class="badge bg-success">Success</span></td>
                                </tr>
                                <tr>
                                    <td>2025-04-04 06:45:23</td>
                                    <td><span class="badge bg-secondary">System</span></td>
                                    <td>Database maintenance completed</td>
                                    <td><span class="badge bg-success">Success</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize DataTables for better table interaction
    if ($.fn.DataTable) {
        $('#activity-table').DataTable({
            pageLength: 5,
            lengthMenu: [5, 10, 25],
            order: [[0, 'desc']],
            language: {
                search: "<i class='fas fa-search'></i>",
                lengthMenu: "_MENU_ records per page",
            }
        });
    }
    
    // Quality metrics chart
    const qualityCtx = document.getElementById('qualityChart').getContext('2d');
    const qualityChart = new Chart(qualityCtx, {
        type: 'radar',
        data: {
            labels: ['Accuracy', 'Completeness', 'Consistency', 'Timeliness', 'Compliance'],
            datasets: [{
                label: 'Current Score',
                data: [95, 92, 88, 97, 94],
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgba(54, 162, 235, 1)'
            }, {
                label: 'Target Score',
                data: [98, 95, 90, 98, 96],
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                pointBackgroundColor: 'rgba(255, 99, 132, 1)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgba(255, 99, 132, 1)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            elements: {
                line: {
                    borderWidth: 3
                }
            },
            plugins: {
                legend: {
                    position: 'bottom',
                }
            },
            scales: {
                r: {
                    angleLines: {
                        display: true,
                        color: 'rgba(255, 255, 255, 0.15)'
                    },
                    suggestedMin: 50,
                    suggestedMax: 100,
                    ticks: {
                        backdropColor: 'transparent',
                        color: 'rgba(255, 255, 255, 0.7)'
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.15)'
                    },
                    pointLabels: {
                        color: 'rgba(255, 255, 255, 0.8)'
                    }
                }
            }
        }
    });

    // API usage chart
    const apiUsageCtx = document.getElementById('apiUsageChart').getContext('2d');
    const apiUsageChart = new Chart(apiUsageCtx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'Market Data API',
                data: [5400, 5900, 6700, 7400, 8200, 8900],
                fill: true,
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                tension: 0.4
            }, {
                label: 'ESG Data API',
                data: [1200, 1900, 3000, 4800, 6200, 7500],
                fill: true,
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                borderColor: 'rgba(153, 102, 255, 1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                },
                tooltip: {
                    mode: 'index',
                    intersect: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.7)'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.7)'
                    }
                }
            }
        }
    });
    
    // Counter animation for stats
    const counterElements = document.querySelectorAll('.counter');
    const speed = 200;
    
    counterElements.forEach(counter => {
        const updateCount = () => {
            const target = +counter.innerText.replace(/[^\d.-]/g, '');
            const count = +counter.getAttribute('data-count') || 0;
            const increment = target / speed;
            
            if (count < target) {
                counter.setAttribute('data-count', count + increment);
                counter.innerText = Math.ceil(count + increment) + (counter.innerText.includes('+') ? '+' : counter.innerText.includes('%') ? '%' : '');
                setTimeout(updateCount, 1);
            } else {
                counter.innerText = target + (counter.innerText.includes('+') ? '+' : counter.innerText.includes('%') ? '%' : '');
            }
        };
        
        // Start the animation when element is in viewport
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    updateCount();
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.5 });
        
        observer.observe(counter);
    });
    
    // Refresh button animation and functionality
    const refreshBtn = document.querySelector('.refresh-btn');
    refreshBtn.addEventListener('click', function() {
        const icon = this.querySelector('i');
        icon.classList.add('fa-spin');
        
        // Simulate refresh delay
        setTimeout(() => {
            icon.classList.remove('fa-spin');
            
            // Show toast notification
            const toastContainer = document.createElement('div');
            toastContainer.className = 'position-fixed bottom-0 end-0 p-3';
            toastContainer.style.zIndex = '1050';
            
            toastContainer.innerHTML = `
                <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header bg-success text-white">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong class="me-auto">Success</strong>
                        <small>Just now</small>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        Activity data refreshed successfully!
                    </div>
                </div>
            `;
            
            document.body.appendChild(toastContainer);
            
            setTimeout(() => {
                toastContainer.remove();
            }, 3000);
        }, 1000);
    });
});
</script>
{% endblock %}